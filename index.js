const express=require("express"),cors=require("cors"),path=require("path"),dotenv=require("dotenv"),swe=require("swisseph"),{computeKundali:e}=require("./src/engine"),{computeVimshottariFromMoon:s}=require("./src/dasha/vimshottari");dotenv.config();const app=express();app.use(cors()),app.use(express.json());const ephePath=process.env.EPHE_DIR?path.resolve(process.cwd(),process.env.EPHE_DIR):path.resolve(process.cwd(),"ephe");swe.swe_set_ephe_path(ephePath+path.sep),swe.swe_set_sid_mode(swe.SE_SIDM_LAHIRI,0,0),app.get("/health",(e,s)=>{s.json({ok:!0,ephePath})}),app.post("/kundali",async(t,a)=>{try{let o=t.body,{gender:n,country:p,city:r,name:h}=o,i=await e(o),c=s({birthDate:o.birthDate,birthTime:o.birthTime,timeZone:o.timeZone,moonSiderealDeg:i.planets.Moon.sidereal,totalYears:120});a.json({...i,gender:n,country:p,city:r,name:h,dasha:c})}catch(d){console.error(d),a.status(500).json({error:d?.message||String(d)})}});const PORT = process.env.PORT || 8080;app.listen(PORT, '0.0.0.0', () => {console.log(`Kundali engine listening on : ${PORT}`);});
